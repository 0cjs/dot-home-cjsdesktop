#!/usr/bin/env bash
set -o pipefail

die() { echo 1>&2 "$(basename "$0"):" "$@"; exit 1; }


height=$(xwininfo -root | sed -n -e 's/ *Height: //p') \
    || die 'Cannot get root window height.'
SML() {
    local -a sml
    IFS=, read -r -a sml <<< "$*"
    if   [[ $height -lt 1620 ]]; then   echo ${sml[0]};
    elif [[ $height -lt 2700 ]]; then   echo ${sml[1]};
    else                                echo ${sml[2]};
    fi
}
join() { local IFS=,; echo "$*"; }

#   We really should be reading this from the screen's X resources
fontlist=(
    "xft:Source Code Pro:size=$(SML 8,9,10)"
    "xft:Source Han Sans,xft:DejaVu Serif:size=$(SML 7,8,9)"
    "xft:DejaVu Sans Mono:size=$(SML 7,8,9)"
)


if [[ $1 = -n ]]; then
    shift
    prefix=
    suffix=
else
    prefix='\033]710;'
    suffix='\033\\'
fi

arg="$*"
if [[ -z $arg ]]; then
    : # Use standard fontlist
elif [[ $arg = :* ]]; then
    #   change property of first font
    fontlist[0]="${fontlist[0]}$arg"
else
    #   Change name of first font
    fontlist[0]=${fontlist[0]/:*:/:$arg:}
fi

echo -e "$prefix$(join "${fontlist[@]}")$suffix"
